# railway.toml
[build]
builder = "NIXPACKS"
buildCommand = "echo 'Building frontend and backend...'"

[deploy]
startCommand = """
echo "ğŸš€ Starting deployment..." &&
echo "ğŸ“¦ Installing frontend dependencies..." &&
cd frontend && npm ci &&
echo "ğŸ”¨ Building frontend..." &&
npm run build &&
echo "ğŸ Setting up backend..." &&
cd ../backend &&
echo "ğŸ“‹ Running Django migrations..." &&
python manage.py migrate &&
echo "ğŸ“ Collecting static files..." &&
python manage.py collectstatic --noinput &&
echo "ğŸµ Starting Django server..." &&
gunicorn music_streaming.wsgi:application --bind 0.0.0.0:$PORT --workers 2 --timeout 120
"""

healthcheckPath = "/api/health/"
healthcheckTimeout = 300
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 3

[env]
# Python ç’°å¢ƒè®Šæ•¸
PYTHONPATH = "/app/backend"
DJANGO_SETTINGS_MODULE = "music_streaming.settings"
PYTHONUNBUFFERED = "1"

# Node.js ç’°å¢ƒè®Šæ•¸
NODE_ENV = "production"
NPM_CONFIG_PRODUCTION = "false"

# æ‡‰ç”¨ç¨‹å¼è®Šæ•¸
PORT = "8000"